{{ define "main" }}
<div class="index-content">
  <!-- Newsletter Header -->
  <div class="newsletter-header">
    <div class="newsletter-card">
      <div class="newsletter-eyebrow">AI + Pharmacy</div>
      <h1 class="newsletter-title">Weekly Briefing â€” {{ .Site.Params.newsletter_date }}</h1>
      <p class="newsletter-subtitle">Highlights, analyses, and scan-friendly insights from the latest research and practice updates.</p>
      
      <!-- Action Buttons -->
      <div class="header-buttons">
        <a href="https://open.spotify.com/episode/5js82Ginc3GJtocFyhLeq1?si=L_2TvkaJQUe5-txjA0rKug" class="header-button podcast-button" target="_blank" rel="noopener">
          <div class="button-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/>
            </svg>
          </div>
          <div class="button-content">
            <div class="button-label">Latest Podcast</div>
            <div class="button-title">Listen Now</div>
          </div>
        </a>
        
        <a href="https://notebooklm.google.com/notebook/e65c8465-055b-47a9-a299-d37d2c8e3fc4" class="header-button notebooklm-button" target="_blank" rel="noopener">
          <div class="button-icon">
            <img src="{{ .Site.BaseURL }}notebooklm.png" alt="NotebookLM" width="20" height="20">
          </div>
          <div class="button-content">
            <div class="button-label">AI Research</div>
            <div class="button-title">NotebookLM</div>
          </div>
        </a>
      </div>
    </div>
  </div>

  <!-- Posts Section -->
  <div class="posts-container">
    {{/* Find the latest newsletter edition date across all posts */}}
    {{ $latestEdition := "" }}
    {{ range .Site.RegularPages }}
      {{ if .Params.newsletter_edition }}
        {{ if or (eq $latestEdition "") (gt .Params.newsletter_edition $latestEdition) }}
          {{ $latestEdition = .Params.newsletter_edition }}
        {{ end }}
      {{ end }}
    {{ end }}
    
    {{/* Filter posts to only those from the latest newsletter edition */}}
    {{ $latestPosts := where .Site.RegularPages ".Params.newsletter_edition" $latestEdition }}
    
    <!-- Major Articles -->
    {{ $majorPosts := where $latestPosts ".Params.type" "major" }}
    {{ if $majorPosts }}
    <div class="major-posts">
      {{ range $majorPosts }}
      <div class="post-tile">
        <a href="{{ .RelPermalink }}">
          <div class="tile-content">
            <h2>{{ .Title }}</h2>
            {{ if .Params.tags }}
            <div class="tile-tags">
              {{ range .Params.tags }}
              {{ $tagText := . }}
              {{ $cssClass := . }}
              {{ if or (hasPrefix . "Predictive ") (hasPrefix . "Generative ") }}
                {{ $parts := split . " " }}
                {{ $cssClass = delimit (after 1 $parts) " " }}
              {{ end }}
              <span class="tag-pill tag-{{ $cssClass | urlize }}">{{ $tagText }}</span>
              {{ end }}
            </div>
            {{ end }}
            {{ if .Params.journal }}
            <div class="tile-journal">Journal: {{ .Params.journal }}</div>
            {{ end }}
            <p>{{ if .Params.description }}{{ .Params.description }}{{ else }}{{ .Summary | truncate 120 }}{{ end }}</p>
            <div class="tile-meta">
              <time>{{ .Date.Format "January 2, 2006" }}</time>
            </div>
          </div>
        </a>
        <div class="tile-actions-wrapper">
          {{ if eq .Params.type "major" }}
          <span class="journal-club-badge" title="Full Journal Club Analysis">Journal Club</span>
          {{ end }}
          {{ partial "read-later-button.html" (dict "articleId" .File.UniqueID "initialSaved" false) }}
        </div>
      </div>
      {{ end }}
    </div>
    {{ end }}

    <!-- Minor Articles -->
    {{ $minorPosts := where $latestPosts ".Params.type" "minor" }}
    {{ if $minorPosts }}
    <div class="minor-posts">
      {{ range $minorPosts }}
      <div class="post-tile post-tile-minor">
        <a href="{{ .RelPermalink }}">
          <div class="tile-content">
            <h2>{{ .Title }}</h2>
            {{ if .Params.tags }}
            <div class="tile-tags">
              {{ range .Params.tags }}
              {{ $tagText := . }}
              {{ $cssClass := . }}
              {{ if or (hasPrefix . "Predictive ") (hasPrefix . "Generative ") }}
                {{ $parts := split . " " }}
                {{ $cssClass = delimit (after 1 $parts) " " }}
              {{ end }}
              <span class="tag-pill tag-{{ $cssClass | urlize }}">{{ $tagText }}</span>
              {{ end }}
            </div>
            {{ end }}
            {{ if .Params.journal }}
            <div class="tile-journal">Journal: {{ .Params.journal }}</div>
            {{ end }}
            <p>{{ if .Params.description }}{{ .Params.description }}{{ else }}{{ .Summary | truncate 120 }}{{ end }}</p>
            <div class="tile-meta">
              <time>{{ .Date.Format "January 2, 2006" }}</time>
            </div>
          </div>
        </a>
        {{ partial "read-later-button.html" (dict "articleId" .File.UniqueID "initialSaved" false) }}
      </div>
      {{ end }}
    </div>
    {{ end }}
  </div>
</div>
{{ end }}
