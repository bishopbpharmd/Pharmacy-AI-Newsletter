<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Deep Learning Model for the Prediction of Vancomycin Trough Concentration | Pharmacy AI Newsletter</title>
<meta name="keywords" content="Model Development">
<meta name="description" content="Evaluation of Nephrocast-V, a sequential deep learning model predicting vancomycin trough concentrations in ICU patients, benchmarked against pharmacist-driven Bayesian dosing.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/vancomycin_ai_journal_club/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.665330518ab4c548c32c86cf53571ffed76390f97bee706ad7c007f49945ff6c.css" integrity="sha256-ZlMwUYq0xUjDLIbPU1cf/tdjkPl77nBq18AH9JlF/2w=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/vancomycin_ai_journal_club/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>


<script>
  window.__AUTH0 = {
    domain: "dev-hgy0ilmv64t2vwb6.us.auth0.com",
    clientId: "gdc8rjiQufmjTKQIF3XNASS1xAdIeNaz",
    audience: "https:\/\/dev-hgy0ilmv64t2vwb6.us.auth0.com\/api\/v2\/"
  };
  
  
  console.log("[Auth0 Config] Injected configuration:", window.__AUTH0);
</script>


<script src="http://localhost:1313/js/auth.js" defer></script>

</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Pharmacy AI Newsletter (Alt + H)">Pharmacy AI Newsletter</a>
            <div class="logo-switches">
            </div>
        </div>
        
        
        <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle mobile menu">
            
            <div class="hamburger-icon">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </div>
            
            <div class="x-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </div>
        </button>
        
        <ul id="menu" class="desktop-menu">
            
            
            <li class="navbar-home">
                <a href="http://localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li class="navbar-archive">
                <a href="http://localhost:1313/posts/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li class="navbar-subscribe" id="navbarSubscribe">
                <a href="#" id="subscribeBtn" title="Subscribe">
                    <span>Subscribe</span>
                </a>
            </li>
            <li class="navbar-auth">
                <a id="loginBtn" class="auth-login-link" href="#">
                    <span>Login</span>
                </a>
            </li>
            <li class="navbar-profile" id="profileLi" style="display: none;">
                <a id="profileBtn" class="auth-profile-link" href="http://localhost:1313/check-subscriber/">
                    <span>Profile</span>
                </a>
            </li>
            <li class="navbar-logout" id="logoutLi" style="display: none;">
                <a id="logoutBtn" class="auth-logout-link" href="#">
                    <span>Logout</span>
                </a>
            </li>
            <li class="navbar-theme-toggle">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme" class="theme-toggle-button">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </li>
        </ul>
        
        
        <div class="mobile-menu-backdrop" id="mobile-menu-backdrop"></div>
        
        
        <div class="mobile-menu-overlay" id="mobile-menu-overlay">
            <div class="mobile-menu-content">
                <div class="mobile-menu-items">
                    <a href="http://localhost:1313/" class="mobile-menu-item">
                        <span>Home</span>
                    </a>
                    <a href="http://localhost:1313/posts/" class="mobile-menu-item">
                        <span>Archive</span>
                    </a>
                    <a href="#" id="mobileSubscribeBtn" class="mobile-menu-item">
                        <span>Subscribe</span>
                    </a>
                    
                    
                    <a id="mobileLoginBtn" class="mobile-menu-item mobile-auth-link" href="#">
                        <span>Login</span>
                    </a>
                        <div id="mobileLogoutBtn" class="mobile-auth-logout-container" style="display: none;">
                            <a id="mobileProfileBtn" class="mobile-menu-item mobile-auth-link" href="http://localhost:1313/check-subscriber/">
                                <span>Profile</span>
                            </a>
                        <a id="mobileLogoutBtn" class="mobile-menu-item mobile-auth-link" href="#">
                            <span>Logout</span>
                        </a>
                    </div>
                    <button class="mobile-menu-item mobile-menu-theme-toggle" id="mobile-theme-toggle" aria-label="Toggle theme">
                        <div class="theme-toggle-content">
                            <span class="theme-label">Theme</span>
                            <div class="theme-icon-container">
                                <svg id="mobile-moon" class="theme-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                                </svg>
                                <svg id="mobile-sun" class="theme-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="5"></circle>
                                    <line x1="12" y1="1" x2="12" y2="3"></line>
                                    <line x1="12" y1="21" x2="12" y2="23"></line>
                                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                    <line x1="1" y1="12" x2="3" y2="12"></line>
                                    <line x1="21" y1="12" x2="23" y2="12"></line>
                                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                                </svg>
                            </div>
                        </div>
                        <div class="theme-toggle-switch">
                            <div class="toggle-slider"></div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </nav>
</header>

<script>

document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
    const mobileMenuBackdrop = document.getElementById('mobile-menu-backdrop');
    const mobileThemeToggle = document.getElementById('mobile-theme-toggle');
    const desktopThemeToggle = document.getElementById('theme-toggle');
    
    
    function toggleMobileMenu() {
        const isActive = mobileMenuOverlay.classList.contains('active');
        
        if (isActive) {
            closeMobileMenu();
        } else {
            openMobileMenu();
        }
    }
    
    function openMobileMenu() {
        mobileMenuBackdrop.classList.add('active');
        mobileMenuOverlay.classList.add('active');
        mobileMenuToggle.classList.add('active');
        document.body.style.overflow = 'hidden'; 
    }
    
    function closeMobileMenu() {
        mobileMenuBackdrop.classList.remove('active');
        mobileMenuOverlay.classList.remove('active');
        mobileMenuToggle.classList.remove('active');
        document.body.style.overflow = ''; 
    }
    
    
    if (mobileMenuToggle) {
        mobileMenuToggle.addEventListener('click', toggleMobileMenu);
    }
    
    
    if (mobileMenuBackdrop) {
        mobileMenuBackdrop.addEventListener('click', closeMobileMenu);
    }
    
    
    const mobileMenuItems = document.querySelectorAll('.mobile-menu-item:not(.mobile-menu-theme-toggle)');
    mobileMenuItems.forEach(item => {
        item.addEventListener('click', closeMobileMenu);
    });
    
    
    if (mobileThemeToggle && desktopThemeToggle) {
        mobileThemeToggle.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            desktopThemeToggle.click(); 
            updateMobileThemeToggle(); 
            
        });
    }
    
    
    function updateMobileThemeToggle() {
        const isDark = document.body.classList.contains('dark');
        const moonIcon = document.getElementById('mobile-moon');
        const sunIcon = document.getElementById('mobile-sun');
        const toggleSwitch = document.querySelector('.theme-toggle-switch');
        
        if (isDark) {
            moonIcon.classList.add('active');
            sunIcon.classList.remove('active');
            toggleSwitch.classList.add('active');
        } else {
            sunIcon.classList.add('active');
            moonIcon.classList.remove('active');
            toggleSwitch.classList.remove('active');
        }
    }
    
    
    updateMobileThemeToggle();
    
    
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && mobileMenuOverlay.classList.contains('active')) {
            closeMobileMenu();
        }
    });
    
    
    window.addEventListener('resize', function() {
        if (window.innerWidth > 768 && mobileMenuOverlay.classList.contains('active')) {
            closeMobileMenu();
        }
    });
    
    
    const subscribeBtn = document.getElementById('subscribeBtn');
    const mobileSubscribeBtn = document.getElementById('mobileSubscribeBtn');
    
    
    function oldShowSubscribeForm() {
        console.log('[Subscribe] Attempting to show EmailOctopus form...');
        console.log('[Subscribe] Document ready state:', document.readyState);
        console.log('[Subscribe] All scripts on page:', document.querySelectorAll('script').length);
        
        
        let isDarkTheme = false;
        
        
        const themePreference = localStorage.getItem("pref-theme");
        if (themePreference === "dark") {
            isDarkTheme = true;
        } else if (themePreference === "light") {
            isDarkTheme = false;
        }
        
        
        else if (document.body.classList.contains('dark')) {
            isDarkTheme = true;
        }
        
        
        else {
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                const sunIcon = document.getElementById('sun');
                const moonIcon = document.getElementById('moon');
                if (sunIcon && sunIcon.style.display === 'none') {
                    isDarkTheme = true;
                } else if (moonIcon && moonIcon.style.display === 'none') {
                    isDarkTheme = false;
                }
            }
        }
        
        
        if (themePreference === null) {
            isDarkTheme = window.matchMedia('(prefers-color-scheme: dark)').matches;
        }
        
        console.log('[Subscribe] Theme detection results:');
        console.log('[Subscribe] localStorage pref-theme:', themePreference);
        console.log('[Subscribe] Body classes:', document.body.className);
        console.log('[Subscribe] Body has dark class:', document.body.classList.contains('dark'));
        console.log('[Subscribe] System prefers dark:', window.matchMedia('(prefers-color-scheme: dark)').matches);
        console.log('[Subscribe] Final isDark result:', isDarkTheme);
        
        
        const lightFormId = 'add30b9c-a238-11f0-98d5-6727ec6b3f72';
        const darkFormId = '5691337a-a244-11f0-aa3f-791dbf3c50f2';
        const selectedFormId = isDarkTheme ? darkFormId : lightFormId;
        
        console.log('[Subscribe] Selected form ID:', selectedFormId);
        
        
        const modalForm = document.querySelector(`[data-form="${selectedFormId}"]:not(script)`);
        console.log('[Subscribe] Modal form found:', modalForm);
        
        
        const emailOctopusModal = document.querySelector(`.modal-container[data-form="${selectedFormId}"]`);
        console.log('[Subscribe] EmailOctopus modal found:', emailOctopusModal);
        
        
        const targetModal = modalForm || emailOctopusModal;
        
        if (targetModal) {
            console.log('[Subscribe] Modal form exists, showing it');
            
            targetModal.classList.add('active');
            targetModal.style.display = 'block';
            targetModal.style.visibility = 'visible';
            targetModal.style.opacity = '1';
            targetModal.style.zIndex = '9999';
            
            
            const modalContainer = targetModal.closest('.modal-container') || targetModal;
            if (modalContainer && modalContainer !== targetModal) {
                console.log('[Subscribe] Modal container found, showing it');
                modalContainer.classList.add('active');
                modalContainer.style.display = 'block';
                modalContainer.style.visibility = 'visible';
                modalContainer.style.opacity = '1';
                modalContainer.style.zIndex = '9999';
            }
            
            
            const closeButton = targetModal.querySelector('.close');
            if (closeButton) {
                closeButton.addEventListener('click', function() {
                    console.log('[Subscribe] Close button clicked');
                    targetModal.classList.remove('active');
                    targetModal.style.display = 'none';
                    if (modalContainer && modalContainer !== targetModal) {
                        modalContainer.classList.remove('active');
                        modalContainer.style.display = 'none';
                    }
                });
            }
            
            
            targetModal.addEventListener('click', function(e) {
                if (e.target === targetModal) {
                    console.log('[Subscribe] Backdrop clicked');
                    targetModal.classList.remove('active');
                    targetModal.style.display = 'none';
                    if (modalContainer && modalContainer !== targetModal) {
                        modalContainer.classList.remove('active');
                        modalContainer.style.display = 'none';
                    }
                }
            });
            
            
            const handleModalResize = () => {
                if (targetModal && targetModal.classList.contains('active')) {
                    console.log('[Subscribe] Window resized, maintaining modal position');
                    
                    targetModal.style.display = 'none';
                    setTimeout(() => {
                        targetModal.style.display = 'flex';
                    }, 10);
                }
            };
            
            window.addEventListener('resize', handleModalResize);
            
        } else {
            console.log('[Subscribe] Modal form not found, checking for EmailOctopus script...');
            
            
            const emailOctopusScript = document.querySelector('script[src*="eocampaign1.com"]');
            console.log('[Subscribe] EmailOctopus script element:', emailOctopusScript);
            
            if (emailOctopusScript) {
                console.log('[Subscribe] Script element exists, waiting for it to execute...');
                
                
                let attempts = 0;
                const maxAttempts = 10;
                
                const checkForForm = () => {
                    attempts++;
                    console.log(`[Subscribe] Attempt ${attempts}/${maxAttempts} to find modal form...`);
                    
                    const retryModal = document.querySelector(`[data-form="${selectedFormId}"]:not(script)`);
                    const retryEmailOctopusModal = document.querySelector(`.modal-container[data-form="${selectedFormId}"]`);
                    if (retryModal || retryEmailOctopusModal) {
                        console.log('[Subscribe] Modal form found after waiting!');
                        showSubscribeForm(); 
                        return;
                    }
                    
                    if (attempts < maxAttempts) {
                        setTimeout(checkForForm, 500); 
                    } else {
                        console.log('[Subscribe] Modal form still not found after all attempts');
                        console.log('[Subscribe] All elements with data-form attribute:', document.querySelectorAll('[data-form]'));
                        console.log('[Subscribe] All modal-related elements:', document.querySelectorAll('[class*="modal"], [class*="popup"], [class*="overlay"]'));
                        
                        
                        const allEmailOctopusElements = document.querySelectorAll('[class*="emailoctopus"], [id*="emailoctopus"], [data-emailoctopus]');
                        console.log('[Subscribe] All EmailOctopus elements:', allEmailOctopusElements);
                        
                        
                        console.log('[Subscribe] Trying alternative trigger methods...');
                        
                        
                        const customEvent = new CustomEvent('emailoctopus:show', {
                            detail: { formId: selectedFormId }
                        });
                        document.dispatchEvent(customEvent);
                        
                        
                        const triggerElements = document.querySelectorAll('[data-emailoctopus-trigger], [onclick*="emailoctopus"], [href*="emailoctopus"]');
                        console.log('[Subscribe] Trigger elements found:', triggerElements);
                        triggerElements.forEach(el => {
                            console.log('[Subscribe] Clicking trigger element:', el);
                            el.click();
                        });
                        
                        
                        const hiddenForms = document.querySelectorAll('[style*="display: none"], [style*="visibility: hidden"]');
                        hiddenForms.forEach(form => {
                            if (form.innerHTML.includes(selectedFormId) || 
                                form.innerHTML.includes('emailoctopus')) {
                                console.log('[Subscribe] Found hidden EmailOctopus form, showing it');
                                form.style.display = 'block';
                                form.style.visibility = 'visible';
                                form.style.opacity = '1';
                                form.style.zIndex = '9999';
                            }
                        });
                    }
                };
                
                checkForForm();
                
            } else {
                console.log('[Subscribe] EmailOctopus script not found in DOM');
            }
        }
    }
    
    
    
    
    
    
    updateNavbarSubscriptionButton();
    
    
    checkAuthAndClearStorage();
    
    
    initializeSubscriptionModal();
});



function updateNavbarSubscriptionButton() {
    const subscribeLi = document.getElementById('navbarSubscribe');
    const mobileSubscribeBtn = document.getElementById('mobileSubscribeBtn');
    
    if (!subscribeLi) {
        console.log('[navbar] Subscribe button element not found');
        return;
    }
    
    try {
        const userData = localStorage.getItem('user');
        if (!userData) {
            console.log('[navbar] No user data in localStorage, showing subscribe button');
            subscribeLi.style.display = 'inline-block';
            if (mobileSubscribeBtn) mobileSubscribeBtn.style.display = 'block';
            return;
        }
        
        const user = JSON.parse(userData);
        console.log('[navbar] User data found:', user);
        
        if (user.subscribed === true) {
            console.log('[navbar] User is subscribed, hiding subscribe button');
            subscribeLi.style.display = 'none';
            if (mobileSubscribeBtn) mobileSubscribeBtn.style.display = 'none';
        } else {
            console.log('[navbar] User is not subscribed, showing subscribe button');
            subscribeLi.style.display = 'inline-block';
            if (mobileSubscribeBtn) mobileSubscribeBtn.style.display = 'block';
        }
        
    } catch (error) {
        console.error('[navbar] Error reading user data:', error);
        
        subscribeLi.style.display = 'inline-block';
        if (mobileSubscribeBtn) mobileSubscribeBtn.style.display = 'block';
    }
}



async function checkAuthAndClearStorage() {
    try {
        
        const userData = localStorage.getItem('user');
        if (!userData) {
            return; 
        }
        
        console.log('[navbar] Checking if stored user is still authenticated...');
        
        
        let auth0Client = null;
        if (window.auth0Client) {
            auth0Client = window.auth0Client;
        } else if (window.auth && window.auth.auth0Client) {
            auth0Client = window.auth.auth0Client;
        }
        
        if (!auth0Client) {
            console.log('[navbar] Auth0 client not available, keeping localStorage');
            return;
        }
        
        
        const isAuthenticated = await auth0Client.isAuthenticated();
        if (!isAuthenticated) {
            console.log('[navbar] User not authenticated, clearing localStorage');
            localStorage.removeItem('user');
            updateNavbarSubscriptionButton();
        } else {
            console.log('[navbar] User is authenticated, keeping localStorage');
        }
        
    } catch (error) {
        console.error('[navbar] Error checking authentication:', error);
        
        localStorage.removeItem('user');
        updateNavbarSubscriptionButton();
    }
}


window.updateNavbarSubscriptionButton = updateNavbarSubscriptionButton;
window.checkAuthAndClearStorage = checkAuthAndClearStorage;


window.addEventListener('storage', function(e) {
    if (e.key === 'user') {
        console.log('[navbar] localStorage user data changed, updating navbar');
        updateNavbarSubscriptionButton();
    }
});


function initializeSubscriptionModal() {
    const subscribeBtn = document.getElementById('subscribeBtn');
    const mobileSubscribeBtn = document.getElementById('mobileSubscribeBtn');
    
    if (subscribeBtn) {
        subscribeBtn.addEventListener('click', function(e) {
            e.preventDefault();
            showCustomSubscribeModal();
        });
    }
    
    if (mobileSubscribeBtn) {
        mobileSubscribeBtn.addEventListener('click', function(e) {
            e.preventDefault();
            showCustomSubscribeModal();
            
            if (typeof closeMobileMenu === 'function') {
                closeMobileMenu();
            }
        });
    }
    
    
}




function showCustomSubscribeModal() {
    const modal = document.getElementById('customSubscribeModal');
    if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        
        
        const firstNameInput = modal.querySelector('#firstName');
        if (firstNameInput) {
            setTimeout(() => firstNameInput.focus(), 100);
        }
    }
}


function closeCustomSubscribeModal() {
    const modal = document.getElementById('customSubscribeModal');
    if (modal) {
        
        modal.classList.add('closing');
        
        
        setTimeout(() => {
            modal.style.display = 'none';
            modal.classList.remove('closing');
            document.body.style.overflow = '';
            
            
            const form = modal.querySelector('#subscribeForm');
            if (form) {
                form.reset();
                clearFormErrors();
            }
        }, 300); 
    }
}


function clearFormErrors() {
    const errorElements = document.querySelectorAll('.form-error');
    errorElements.forEach(el => el.remove());
    
    const inputs = document.querySelectorAll('.form-input');
    inputs.forEach(input => {
        input.classList.remove('error');
    });
}


function showFormError(input, message) {
    
    const existingError = input.parentNode.querySelector('.form-error');
    if (existingError) {
        existingError.remove();
    }
    
    
    input.classList.add('error');
    
    
    const errorDiv = document.createElement('div');
    errorDiv.className = 'form-error';
    errorDiv.innerHTML = `
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 4px; vertical-align: text-bottom;">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
        ${message}
    `;
    input.parentNode.appendChild(errorDiv);
}


function validateForm(formData) {
    const errors = [];
    
    
    if (!formData.firstName.trim()) {
        errors.push({ field: 'firstName', message: 'First name is required' });
    } else if (formData.firstName.trim().length < 2) {
        errors.push({ field: 'firstName', message: 'First name must be at least 2 characters' });
    } else if (formData.firstName.trim().length > 50) {
        errors.push({ field: 'firstName', message: 'First name must be less than 50 characters' });
    } else if (!/^[a-zA-Z\s\-']+$/.test(formData.firstName.trim())) {
        errors.push({ field: 'firstName', message: 'First name can only contain letters, spaces, hyphens, and apostrophes' });
    }
    
    
    if (!formData.lastName.trim()) {
        errors.push({ field: 'lastName', message: 'Last name is required' });
    } else if (formData.lastName.trim().length < 2) {
        errors.push({ field: 'lastName', message: 'Last name must be at least 2 characters' });
    } else if (formData.lastName.trim().length > 50) {
        errors.push({ field: 'lastName', message: 'Last name must be less than 50 characters' });
    } else if (!/^[a-zA-Z\s\-']+$/.test(formData.lastName.trim())) {
        errors.push({ field: 'lastName', message: 'Last name can only contain letters, spaces, hyphens, and apostrophes' });
    }
    
    
    if (!formData.email.trim()) {
        errors.push({ field: 'email', message: 'Email address is required' });
    } else {
        const email = formData.email.trim().toLowerCase();
        const emailRegex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;
        
        if (!emailRegex.test(email)) {
            errors.push({ field: 'email', message: 'Please enter a valid email address' });
        } else if (email.length > 254) {
            errors.push({ field: 'email', message: 'Email address is too long' });
        } else if (email.includes('..') || email.startsWith('.') || email.endsWith('.')) {
            errors.push({ field: 'email', message: 'Email address format is invalid' });
        }
    }
    
    
    if (!formData.company.trim()) {
        errors.push({ field: 'company', message: 'Company/Organization is required' });
    } else if (formData.company.trim().length < 2) {
        errors.push({ field: 'company', message: 'Company name must be at least 2 characters' });
    } else if (formData.company.trim().length > 100) {
        errors.push({ field: 'company', message: 'Company name must be less than 100 characters' });
    }
    
    return errors;
}


async function handleSubscribeForm(event) {
    event.preventDefault();
    
    const form = event.target;
    const formData = {
        firstName: form.firstName.value.trim(),
        lastName: form.lastName.value.trim(),
        email: form.email.value.trim(),
        company: form.company.value.trim()
    };
    
    
    clearFormErrors();
    
    
    const errors = validateForm(formData);
    if (errors.length > 0) {
        errors.forEach(error => {
            const input = form[error.field];
            showFormError(input, error.message);
        });
        return;
    }
    
    
    const submitBtn = form.querySelector('.form-submit-btn');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Subscribing...';
    submitBtn.disabled = true;
    submitBtn.classList.add('loading');
    
    try {
        const response = await fetch('/.netlify/functions/subscribe-user', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        
        let result;
        const contentType = response.headers.get('content-type');
        if (contentType && contentType.includes('application/json')) {
            result = await response.json();
        } else {
            
            const text = await response.text();
            throw new Error(`Server error (${response.status}): ${text || 'Unable to process subscription'}`);
        }
        
        if (response.ok && result.success) {
            
            showSubscriptionSuccess();
            closeCustomSubscribeModal();
            
            
            if (typeof updateNavbarSubscriptionButton === 'function') {
                updateNavbarSubscriptionButton();
            }
        } else {
            throw new Error(result.error || 'Subscription failed');
        }
        
    } catch (error) {
        console.error('Subscription error:', error);
        
        
        const errorDiv = document.createElement('div');
        errorDiv.className = 'form-error form-error-general';
        
        
        let errorMessage = 'Subscription failed';
        let errorIcon = '‚ö†Ô∏è';
        let errorHelp = 'Please check your information and try again, or contact support if the problem persists.';
        
        if (error.message.includes('already subscribed')) {
            errorMessage = 'This email address is already subscribed to our newsletter.';
            errorIcon = 'üìß';
            errorHelp = 'You can use a different email address or contact us if you need to update your subscription.';
        } else if (error.message.includes('Network error') || error.message.includes('fetch')) {
            errorMessage = 'Network connection issue. Please check your internet connection and try again.';
            errorIcon = 'üåê';
            errorHelp = 'Make sure you have a stable internet connection and try submitting the form again.';
        } else if (error.message.includes('Server error') || error.message.includes('404') || error.message.includes('500')) {
            errorMessage = 'Service temporarily unavailable. Please try again in a few moments.';
            errorIcon = 'üîß';
            errorHelp = 'Our subscription service is currently being updated. Please try again shortly.';
        } else if (error.message.includes('JSON')) {
            errorMessage = 'Unable to process your subscription request.';
            errorIcon = 'üîß';
            errorHelp = 'There seems to be a technical issue. Please try again or contact support.';
        } else if (error.message.includes('Missing required fields')) {
            errorMessage = 'Please fill in all required fields.';
            errorIcon = 'üìù';
            errorHelp = 'Make sure all form fields are completed before submitting.';
        } else if (error.message.includes('Invalid email format')) {
            errorMessage = 'Please enter a valid email address.';
            errorIcon = 'üìß';
            errorHelp = 'Check that your email address is formatted correctly (e.g., name@example.com).';
        } else if (error.message) {
            
            errorMessage = error.message.replace(/^Server error \(\d+\): /, '').replace(/^Unexpected non-whitespace character.*/, 'Unable to process your subscription request.');
            errorIcon = '‚ùå';
        }
        
        errorDiv.innerHTML = `
            <div class="error-content">
                <div class="error-icon">${errorIcon}</div>
                <div class="error-text">
                    <div class="error-title">Subscription Error</div>
                    <div class="error-message">${errorMessage}</div>
                    <div class="error-help">${errorHelp}</div>
                </div>
            </div>
        `;
        
        const formContent = form.querySelector('.form-content');
        const existingError = formContent.querySelector('.form-error-general');
        if (existingError) {
            existingError.remove();
        }
        
        formContent.appendChild(errorDiv);
        
        
        errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
    } finally {
        
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
        submitBtn.classList.remove('loading');
    }
}


function showSubscriptionSuccess() {
    
    const toast = document.createElement('div');
    toast.className = 'subscribe-success-toast';
    toast.innerHTML = `
        <div class="toast-content">
            <div class="toast-icon">‚úì</div>
            <div class="toast-message">
                <strong>Successfully subscribed!</strong>
                <p>Thank you for subscribing to our newsletter.</p>
            </div>
        </div>
    `;
    
    document.body.appendChild(toast);
    
    
    setTimeout(() => toast.classList.add('show'), 100);
    
    
    setTimeout(() => {
        toast.classList.remove('show');
        
        setTimeout(() => {
            if (toast.parentNode) {
                toast.remove();
            }
        }, 300); 
    }, 5000);
}


function handleModalBackdropClick(event) {
    if (event.target.id === 'customSubscribeModal') {
        closeCustomSubscribeModal();
    }
}


window.showCustomSubscribeModal = showCustomSubscribeModal;
window.closeCustomSubscribeModal = closeCustomSubscribeModal;
window.handleSubscribeForm = handleSubscribeForm;
window.handleModalBackdropClick = handleModalBackdropClick;
</script>


<div id="customSubscribeModal" class="custom-subscribe-modal" onclick="handleModalBackdropClick(event)">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Subscribe to Newsletter</h2>
            <button class="modal-close-btn" onclick="closeCustomSubscribeModal()" aria-label="Close">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        
        <div class="modal-body">
            <p class="modal-description">
                Stay updated with the latest Pharmacy AI research and insights delivered to your inbox.
            </p>
            
            <form id="subscribeForm" class="subscribe-form" onsubmit="handleSubscribeForm(event)">
                <div class="form-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName" class="form-label">First Name</label>
                            <input 
                                type="text" 
                                id="firstName" 
                                name="firstName" 
                                class="form-input" 
                                required 
                                autocomplete="given-name"
                            >
                        </div>
                        
                        <div class="form-group">
                            <label for="lastName" class="form-label">Last Name</label>
                            <input 
                                type="text" 
                                id="lastName" 
                                name="lastName" 
                                class="form-input" 
                                required 
                                autocomplete="family-name"
                            >
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email" class="form-label">Email Address</label>
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            class="form-input" 
                            required 
                            autocomplete="email"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="company" class="form-label">Company/Organization</label>
                        <input 
                            type="text" 
                            id="company" 
                            name="company" 
                            class="form-input" 
                            required 
                            autocomplete="organization"
                        >
                    </div>
                    
                    <button type="submit" class="form-submit-btn">
                        Subscribe to Newsletter
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<main class="main">

<nav class="post-navigation">
  <a href="http://localhost:1313/" class="back-to-posts">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="19" y1="12" x2="5" y2="12"></line>
      <polyline points="12 19 5 12 12 5"></polyline>
    </svg>
    <span>Back to Posts</span>
  </a>
</nav>

<article class="post-single">
  <header class="post-header">
    

<button 
  class="read-later-bookmark" 
  data-article-id="73eebbd91259bfd9bca91ba78d9ec15c"
  data-saved="false"
  aria-pressed="false"
  aria-label="Save to reading list"
  title="Save to reading list"
  style="display: none;"
>
  
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
    </svg>
  
</button>


    <h1 class="post-title entry-hint-parent">
      Deep Learning Model for the Prediction of Vancomycin Trough Concentration
    </h1>
    <div class="post-tags-header">
      
      <span class="tag-pill tag-model-development">Model Development</span>
      
    </div>
    <div class="post-metadata-card">
      <div class="metadata-row">
        <span class="metadata-label">Authors:</span>
        <span class="metadata-value">Ghanbari G, Stevens C, Aronoff-Spencer E, Malhotra A, Nemati S, Yousif Z.</span>
      </div>
      <div class="metadata-row">
        <span class="metadata-label">Journal:</span>
        <span class="metadata-value">Pharmacotherapy</span>
      </div>
      <div class="metadata-row">
        <span class="metadata-label">DOI:</span>
        <span class="metadata-value">
          <a href="https://doi.org/10.1002/phar.70062" target="_blank" rel="noopener">10.1002/phar.70062</a>
        </span>
      </div>
    </div>
    <div class="post-description">
      Evaluation of Nephrocast-V, a sequential deep learning model predicting vancomycin trough concentrations in ICU patients, benchmarked against pharmacist-driven Bayesian dosing.
    </div>
    <div class="post-meta"><span title='2025-10-04 11:38:37 -0400 EDT'>October 4, 2025</span>

</div>
  </header> 
  <div class="post-content journal-club-content"><h2 id="clinicaloperational-question">Clinical/Operational Question<a hidden class="anchor" aria-hidden="true" href="#clinicaloperational-question">#</a></h2>
<p>Can a sequential deep learning model (‚ÄúNephrocast-V‚Äù) accurately forecast vancomycin trough levels ~48 hours ahead in ICU patients and recommend dose adjustments to attain therapeutic levels, compared to standard pharmacist-driven Bayesian dosing?</p>
<hr>
<h2 id="background--rationale">Background &amp; Rationale<a hidden class="anchor" aria-hidden="true" href="#background--rationale">#</a></h2>
<p><strong>TDM Challenge:</strong> Only ~34% of critically ill patients reach therapeutic vancomycin levels in the first 48h of therapy (under 40% by day 3). Traditional Bayesian dosing models use limited covariates and assume stable renal function‚Äîassumptions often violated in ICU (e.g., rapid AKI changes).</p>
<p><strong>Need for Precision:</strong> Guidelines endorse AUC-guided dosing (target AUC/MIC 400‚Äì600) via Bayesian tools, but implementation is labor-intensive and not universally adopted. Pharmacist-led dosing improves outcomes yet requires time-intensive individualization.</p>
<p><strong>AI Potential:</strong> Machine learning can learn from high-dimensional EHR data and capture complex PK dynamics. Prior vancomycin ML models showed improved accuracy over PopPK but had limitations‚Äîshort windows, no direct comparison to clinicians, or only initial troughs. Nephrocast-V addresses these by predicting 48h ahead and benchmarking against pharmacists.</p>
<hr>
<h2 id="methods-snapshot">Methods Snapshot<a hidden class="anchor" aria-hidden="true" href="#methods-snapshot">#</a></h2>
<ul>
<li><strong>Design/Setting:</strong> Retrospective single-center cohort at two UCSD ICUs (Jan 2016‚ÄìJun 2024).</li>
<li><strong>Inclusion:</strong> Adult ICU patients ‚â•24h, intermittent IV vancomycin.</li>
<li><strong>Exclusions:</strong> Continuous infusions, RRT within 7d, ICU stay &gt;14d.</li>
<li><strong>Outcome:</strong> Steady-state trough ~2 days after prediction point.</li>
<li><strong>Model:</strong> LSTM + 2-head attention + dense layer with skip connections.</li>
<li><strong>Predictors:</strong> 253 EHR variables‚Äîdemographics, comorbidities, labs, vitals, meds, prior vanco levels, doses between prediction and trough.</li>
<li><strong>Comparison:</strong> ICU pharmacists using PrecisePK Bayesian software.</li>
<li><strong>Dose Adjustment Simulation:</strong> Incremental ¬±250mg adjustments tested.</li>
</ul>
<hr>
<h2 id="key-results">Key Results<a hidden class="anchor" aria-hidden="true" href="#key-results">#</a></h2>
<ul>
<li><strong>Cohort:</strong> 2,205 ICU vancomycin encounters (~2,492 troughs). Median age 58; 64% male; 44% experienced AKI.</li>
<li><strong>Prediction Accuracy:</strong> MAE 3.15 mg/L, RMSE 4.17 mg/L‚Äîcomparable to pharmacists (MAE 3.06, RMSE 4.07).</li>
<li><strong>Therapeutic Range Classification:</strong> Both model and pharmacists ~56% accuracy in categorizing troughs.</li>
<li><strong>High-Error Scenarios:</strong> AKI onset/recovery, low muscle mass, obesity, very low baseline SCr.</li>
<li><strong>Key Feature Drivers:</strong> Current dose most influential, followed by SCr, length of stay, lab values, sex, sepsis/SIRS indicators.</li>
<li><strong>Dose Recommendations:</strong> Closer alignment with Nephrocast-V dosing associated with more therapeutic troughs.</li>
</ul>
<hr>
<h2 id="strengths">Strengths<a hidden class="anchor" aria-hidden="true" href="#strengths">#</a></h2>
<ul>
<li>Large real-world ICU dataset (‚âà2.5k troughs, &gt;2k encounters).</li>
<li>Broad inputs beyond PopPK models.</li>
<li>Modern architecture (LSTM + attention, skip connections).</li>
<li>Benchmark against pharmacists with Bayesian software.</li>
<li>Actionable dose recommendations, not just predictions.</li>
<li>Thorough error analysis and feature importance transparency.</li>
</ul>
<hr>
<h2 id="limitations">Limitations<a hidden class="anchor" aria-hidden="true" href="#limitations">#</a></h2>
<ul>
<li>Single-center, internal validation only.</li>
<li>Excluded dialysis and prolonged ICU cases.</li>
<li>Trough-focused despite AUC guideline emphasis.</li>
<li>Retrospective‚Äîno prospective patient outcomes.</li>
<li>Semi-structured data extraction may introduce bias.</li>
<li>Mostly adult/White cohort; pediatric/ethnic subgroup performance unknown.</li>
</ul>
<hr>
<h2 id="ai-specific-considerations">AI-Specific Considerations<a hidden class="anchor" aria-hidden="true" href="#ai-specific-considerations">#</a></h2>
<ul>
<li><strong>Training/Generalizability:</strong> Local UCSD data only; external validation needed.</li>
<li><strong>Explainability:</strong> Gradient-based importance aligned with clinical logic, but SHAP/interpretability tools recommended.</li>
<li><strong>Bias &amp; Fairness:</strong> Possible subgroup differences (e.g., sex, ICU type).</li>
<li><strong>Regulatory Oversight:</strong> Likely CDS under FDA regulation if logic opaque.</li>
<li><strong>Maintenance:</strong> Risk of model drift‚Äîrequires periodic re-training.</li>
</ul>
<hr>
<h2 id="applicability-to-pharmacy-informatics">Applicability to Pharmacy Informatics<a hidden class="anchor" aria-hidden="true" href="#applicability-to-pharmacy-informatics">#</a></h2>
<ul>
<li>Integration via CDS Hooks or SMART-on-FHIR (e.g., during order verification).</li>
<li>Workflow fit: EMR side-panel, BPA, or dosing advisor.</li>
<li>Data pipeline: HL7/FHIR mapping of SCr, dosing history, labs.</li>
<li>Alerting: Non-intrusive, rationale-based to avoid fatigue.</li>
<li>Training &amp; Acceptance: Scope/limits education, pilot phase trials.</li>
<li>Governance: Override logging, pharmacist review, continuous QI.</li>
</ul>
<hr>
<h2 id="related-literature-synthesis-table">Related Literature Synthesis Table<a hidden class="anchor" aria-hidden="true" href="#related-literature-synthesis-table">#</a></h2>
<p><strong>[A] Hu et al. 2025 (Front Pharmacol)</strong></p>
<ul>
<li>Random Forest vs PopPK for troughs (n=546).</li>
<li>Achieved 84% accuracy vs Bayesian 57%.</li>
<li>No dose recommendations; short prediction horizon.</li>
<li><strong>Takeaway:</strong> Even simple ML &gt; PopPK; supports AI in trough targeting.</li>
</ul>
<p><strong>[B] Chen et al. 2025 (Microbiol Spectr)</strong></p>
<ul>
<li>ICU sepsis cohort (n=4,059). Compared PopPK, Bayesian, ML, Hybrid PK+ML.</li>
<li>Hybrid best without drug levels; Bayesian best with trough data.</li>
<li><strong>Takeaway:</strong> Optimal approach context-dependent; future CDS may dynamically select method.</li>
</ul>
<p><strong>[C] Nigo et al. 2022 (J Biomed Inform)</strong></p>
<ul>
<li>PK-RNN-V<!-- raw HTML omitted -->E<!-- raw HTML omitted -->, deep learning on 55k vanco levels.</li>
<li>Outperformed Bayesian RMSE 5.39 vs 6.29 mg/L.</li>
<li>Did not provide dosing adjustments.</li>
<li><strong>Takeaway:</strong> Early validation of RNN-based AI in vancomycin; Nephrocast-V extends horizon + attention.</li>
</ul>
<hr>
<h2 id="evidence-quality--recommendation">Evidence Quality &amp; Recommendation<a hidden class="anchor" aria-hidden="true" href="#evidence-quality--recommendation">#</a></h2>
<ul>
<li><strong>GRADE:</strong> Low (retrospective, single-site, indirect outcomes).</li>
<li><strong>Practice Recommendation:</strong> Do not replace pharmacist judgment yet. Use as adjunct in pilot studies with oversight.</li>
<li><strong>Discussion Prompt:</strong> What safeguards would you want before trusting AI dosing in ICU?</li>
</ul>
<hr>
<h2 id="bottom-line">Bottom Line<a hidden class="anchor" aria-hidden="true" href="#bottom-line">#</a></h2>
<p>Nephrocast-V predicted vancomycin troughs ~48h ahead with pharmacist-level accuracy in ICU patients. It leverages rich EHR data, offers dose recommendations, and could enhance dosing precision where PopPK models fall short.</p>
<p>Before clinical adoption: external validation, workflow integration, and governance structures are needed. Pharmacists remain central to evaluating and applying AI outputs safely.</p>
<hr>
<h2 id="citation">Citation<a hidden class="anchor" aria-hidden="true" href="#citation">#</a></h2>
<p>Ghanbari G, Stevens C, Aronoff-Spencer E, Malhotra A, Nemati S, Yousif Z. Nephrocast-V: A Deep Learning Model for the Prediction of Vancomycin Trough Concentration Using Electronic Health Record Data. <em>Pharmacotherapy</em>. 2025. doi:10.1002/phar.70062</p>
<hr>
<h2 id="references-primary--comparative-studies">References (Primary + Comparative Studies)<a hidden class="anchor" aria-hidden="true" href="#references-primary--comparative-studies">#</a></h2>
<ol>
<li>Ghanbari G, Stevens C, Aronoff-Spencer E, Malhotra A, Nemati S, Yousif Z. <em>Pharmacotherapy</em>. 2025. doi:10.1002/phar.70062</li>
<li>Hu T, Ding X, Han F, An Z. <em>Front Pharmacol</em>. 2025;16:1549500. doi:10.3389/fphar.2025.1549500</li>
<li>Chen K, Wang C, Wei Y, Ma S, Huang W, Dong Y, et al. <em>Microbiol Spectr</em>. 2025;13(5):e0049925. doi:10.1128/spectrum.00499-25</li>
<li>Nigo M, Tran HTN, Xie Z, Feng H, Mao B, Rasmy L, et al. <em>J Biomed Inform</em>. 2022;133:104166. doi:10.1016/j.jbi.2022.104166</li>
</ol>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/model-development/">Model Development</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Pharmacy AI Newsletter</a></span> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><script src="http://localhost:1313/js/readLaterApi.js" defer></script><script src="http://localhost:1313/js/readLaterButtons.js" defer></script>


<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
